{"version":3,"sources":["EventManager.ts"],"names":["EventTypes","MouseButtons","EventManager","constructor","view","setListeners","addEventListener","event","isPointerInBounds","x","clientX","y","clientY","adaptedEvent","mapEvent","DOWN","target","setPointerCapture","pointerId","addActivePointer","onPointerDown","UP","onPointerUp","releasePointerCapture","removeActivePointer","pointerType","buttons","LEFT","MOVE","inBounds","pointerIndex","activePointers","indexOf","eventType","ENTER","onPointerEnter","onPointerMove","OUT","onPointerOut","onPointerOutOfBounds","preventDefault","CANCEL","onPointerCancel","_event","setOnPointerDown","callback","setOnPointerUp","setOnPointerMove","setOnPointerOut","setOnPointerEnter","setOnPointerCancel","setOnPointerOutOfBounds","offsetX","offsetY","time","timeStamp","rect","getBoundingClientRect","left","right","top","bottom","push","index","splice"],"mappings":"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","sourcesContent":["/* eslint-disable @typescript-eslint/no-empty-function */\n\nimport { EventTypes, AdaptedPointerEvent, MouseButtons } from '../interfaces';\n\nexport default class EventManager {\n  private activePointers: number[] = [];\n  private readonly view: HTMLElement;\n\n  constructor(view: HTMLElement) {\n    this.view = view;\n  }\n\n  public setListeners() {\n    this.view.addEventListener('pointerdown', (event: PointerEvent): void => {\n      if (\n        !this.isPointerInBounds({\n          x: event.clientX,\n          y: event.clientY,\n        })\n      ) {\n        return;\n      }\n\n      const adaptedEvent: AdaptedPointerEvent = this.mapEvent(\n        event,\n        EventTypes.DOWN\n      );\n      const target = event.target as HTMLElement;\n\n      target.setPointerCapture(adaptedEvent.pointerId);\n      this.addActivePointer(adaptedEvent.pointerId);\n      this.onPointerDown(adaptedEvent);\n    });\n\n    this.view.addEventListener('pointerup', (event: PointerEvent): void => {\n      const adaptedEvent: AdaptedPointerEvent = this.mapEvent(\n        event,\n        EventTypes.UP\n      );\n      const target = event.target as HTMLElement;\n\n      this.onPointerUp(adaptedEvent);\n      target.releasePointerCapture(adaptedEvent.pointerId);\n      this.removeActivePointer(adaptedEvent.pointerId);\n    });\n\n    this.view.addEventListener('pointermove', (event: PointerEvent): void => {\n      if (\n        event.pointerType === 'mouse' &&\n        event.buttons !== MouseButtons.LEFT\n      ) {\n        return;\n      }\n\n      const adaptedEvent: AdaptedPointerEvent = this.mapEvent(\n        event,\n        EventTypes.MOVE\n      );\n\n      const inBounds: boolean = this.isPointerInBounds({\n        x: adaptedEvent.x,\n        y: adaptedEvent.y,\n      });\n\n      const pointerIndex: number = this.activePointers.indexOf(\n        adaptedEvent.pointerId\n      );\n\n      if (inBounds) {\n        if (pointerIndex < 0) {\n          adaptedEvent.eventType = EventTypes.ENTER;\n          this.onPointerEnter(adaptedEvent);\n          this.addActivePointer(adaptedEvent.pointerId);\n        } else {\n          this.onPointerMove(adaptedEvent);\n        }\n      } else {\n        if (pointerIndex >= 0) {\n          adaptedEvent.eventType = EventTypes.OUT;\n          this.onPointerOut(adaptedEvent);\n          this.removeActivePointer(adaptedEvent.pointerId);\n        } else {\n          this.onPointerOutOfBounds(adaptedEvent);\n        }\n      }\n    });\n\n    this.view.addEventListener('pointercancel', (event: PointerEvent): void => {\n      event.preventDefault();\n\n      const adaptedEvent: AdaptedPointerEvent = this.mapEvent(\n        event,\n        EventTypes.CANCEL\n      );\n\n      this.onPointerCancel(adaptedEvent);\n    });\n  }\n\n  private onPointerDown(_event: AdaptedPointerEvent): void {}\n  private onPointerUp(_event: AdaptedPointerEvent): void {}\n  private onPointerMove(_event: AdaptedPointerEvent): void {}\n  private onPointerOut(_event: AdaptedPointerEvent): void {}\n  private onPointerEnter(_event: AdaptedPointerEvent): void {}\n  private onPointerCancel(_event: AdaptedPointerEvent): void {}\n  private onPointerOutOfBounds(_event: AdaptedPointerEvent): void {}\n\n  public setOnPointerDown(\n    callback: (event: AdaptedPointerEvent) => void\n  ): void {\n    this.onPointerDown = callback;\n  }\n  public setOnPointerUp(callback: (event: AdaptedPointerEvent) => void): void {\n    this.onPointerUp = callback;\n  }\n  public setOnPointerMove(\n    callback: (event: AdaptedPointerEvent) => void\n  ): void {\n    this.onPointerMove = callback;\n  }\n  public setOnPointerOut(callback: (event: AdaptedPointerEvent) => void): void {\n    this.onPointerOut = callback;\n  }\n  public setOnPointerEnter(\n    callback: (event: AdaptedPointerEvent) => void\n  ): void {\n    this.onPointerEnter = callback;\n  }\n  public setOnPointerCancel(\n    callback: (event: AdaptedPointerEvent) => void\n  ): void {\n    this.onPointerCancel = callback;\n  }\n  public setOnPointerOutOfBounds(\n    callback: (event: AdaptedPointerEvent) => void\n  ): void {\n    this.onPointerOutOfBounds = callback;\n  }\n\n  private mapEvent(\n    event: PointerEvent,\n    eventType: EventTypes\n  ): AdaptedPointerEvent {\n    return {\n      x: event.clientX,\n      y: event.clientY,\n      offsetX: event.offsetX,\n      offsetY: event.offsetY,\n      pointerId: event.pointerId,\n      eventType: eventType,\n      pointerType: event.pointerType,\n      buttons: event.buttons,\n      time: event.timeStamp,\n    };\n  }\n\n  public isPointerInBounds({ x, y }: { x: number; y: number }): boolean {\n    if (!this.view) {\n      return false;\n    }\n\n    const rect: DOMRect = this.view.getBoundingClientRect();\n\n    return (\n      x >= rect.left && x <= rect.right && y >= rect.top && y <= rect.bottom\n    );\n  }\n\n  private addActivePointer(pointerId: number): void {\n    if (this.activePointers.indexOf(pointerId) >= 0) {\n      return;\n    }\n\n    this.activePointers.push(pointerId);\n  }\n\n  private removeActivePointer(pointerId: number): void {\n    const index: number = this.activePointers.indexOf(pointerId);\n\n    if (index < 0) {\n      return;\n    }\n\n    this.activePointers.splice(index, 1);\n  }\n}\n"]}